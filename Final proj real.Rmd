---
title: 'Final Stat 184 Project'
author: "Andrew Harley & Abraham Arbelaez"
date: "Due December 17, 2019"
output:  html_notebook
---

# Purpose

The purpose of this project is to figure out any details that may give an advantage to NFL bettors. 

# Research Question

Does weather or elevation affect the outcome of an NFL, such as the score total or the spread cover?

```{r}
library(DataComputing)
library(mosaicData)
library(tidyverse)
library(dplyr)
library(readr)
library(ggplot2)
```


```{r}
spreadspoke_scores <- read_csv("spreadspoke_scores.csv")
webpage <- "https://www.kaggle.com/tobycrabtree/nfl-scores-and-betting-data#spreadspoke_scores.csv"

nfl_stadiums <- read_csv("nfl_stadiums.csv")
webpage2 <- "https://www.kaggle.com/tobycrabtree/nfl-scores-and-betting-data#nfl_stadiums.csv"
```


```{r}
View(spreadspoke_scores)
View(nfl_stadiums)
```

### Data Wrangling

```{r}
spreadspoke_scores2 <-
spreadspoke_scores %>%
  filter(schedule_season>2009)
```

Since we want data from 2010 on, we filtered out all the cases before then.

```{r}
spreadspoke_scores2 <-
spreadspoke_scores2 %>%
  filter(stadium_neutral== FALSE)
```

Also, we filtered out any games that were at neutral stadiums, so that includes the Super Bowl.

```{r}
spreadspoke_scores2 <-
spreadspoke_scores2 %>%
  mutate(scoretotal = score_away + score_home) %>%
  mutate(over_under_difference = scoretotal - over_under_line) %>%
  mutate(over_or_under = ifelse(over_under_difference > 0, "Over", "Under")) %>%
  filter(over_or_under != "NA")
```

We then created a new variable, which was the total score of each game. Then we used that total score and subtracted it from the over/under line to find the difference between the score and the line. We then created another variable determining if the over or under hit.

```{r}
nfl_stadiums <-
nfl_stadiums %>%
  rename(stadium = stadium_name)
```

In order to join the two data frames together, we renamed the stadium_name to stadium. 

```{r}
nfl_stadiums <-
  nfl_stadiums %>%
  select(stadium, stadium_location, stadium_type, stadium_weather_type, stadium_surface, ELEVATION)
```

Here we are selecting the few variables that we need from the nfl_stadiums data, so we can clean it up befiore we join the two tables. 

```{r}
Scores <-
spreadspoke_scores2 %>%
  left_join(nfl_stadiums)

View(Scores)
```

Here we joined the two tables together to match the stadiums that each game was played at and its info.

```{r}
Scores %>%
  spread(key = over_or_under, value = over_under_difference) %>%
  filter(Over != "NA") %>%
  summarise(avgOver = mean(Over))

Scores %>%
  spread(key = over_or_under, value = over_under_difference) %>%
  filter(Under != "NA") %>%
  summarise(avgUnder = mean(Under))
```

Here we spread the over_or_under variable to have the Over and the Under become two seperate variables with the value being the difference between the score total and the line. Then we took the average score difference for each the over and the under. Here it shows that the average difference when the Over hits is slightly larger than the difference when the Under hits. 

```{r}
Scores %>%
  select(team_home, score_home, team_away, score_away) %>%
  mutate(team = ifelse(score_home > score_away, team_home, team_away)) %>%
  mutate(score = ifelse(score_home > score_away, score_home, score_away)) %>%
  select(team, score) %>%
  group_by(team) %>%
  summarise(wins = n()) %>%
  arrange(desc(wins)) 
```

```{r}
Scores2 <-
  Scores %>%
  mutate(team_favorite = ifelse(team_favorite_id == "NO", "New Orleans Saints", ifelse(team_favorite_id == "MIA", "Miami Dolphins", ifelse(team_favorite_id == "MIN", "Minnesota Vikings",ifelse(team_favorite_id == "CHI", "Chicago Bears", ifelse(team_favorite_id == "BUF", "Buffalo Bills", ifelse(team_favorite_id == "DET", "Detroit Lions", ifelse(team_favorite_id == "IND", "Indianapolis Colts", ifelse(team_favorite_id == "HOU", "Houston Texans", ifelse(team_favorite_id == "JAX", "Jacksonville Jaguars", ifelse(team_favorite_id == "DEN", "Denver Broncos", ifelse(team_favorite_id == "NE", "New England Patriots", ifelse(team_favorite_id == "CIN", "Cincinnati Bengals", ifelse(team_favorite_id == "NYG", "New York Giants", ifelse(team_favorite_id == "CAR", "Carolina Panthers", ifelse(team_favorite_id == "GB", "Green Bay Packers", ifelse(team_favorite_id == "PHI", "Philadelphia Eagles", ifelse(team_favorite_id == "ATL", "Atlanta Falcons", ifelse(team_favorite_id == "PIT", "Pittsburgh Steelers", ifelse(team_favorite_id == "SF", "San Francisco 49ers", ifelse(team_favorite_id == "SEA", "Seattle Seahawks", ifelse(team_favorite_id == "ARI", "Arizona Cardinals", ifelse(team_favorite_id == "LAR", "St. Louis Rams", ifelse(team_favorite_id == "TB", "Tampa Bay Buccaneers", ifelse(team_favorite_id == "OAK", "Oakland Raiders", ifelse(team_favorite_id == "TEN", "Tennessee Titans", ifelse(team_favorite_id == "DAL", "Dallas Cowboys", ifelse(team_favorite_id == "WAS", "Washington Redskins", ifelse(team_favorite_id == "LAC", "San Diego Chargers", ifelse(team_favorite_id == "KC", "Kansas City Chiefs", ifelse(team_favorite_id == "NYJ", "New York Jets", "Baltimore Ravens" ))))))))))))))))))))))))))))))) %>%
  mutate(home_team_fav = ifelse(team_favorite == team_home, "Home", "Away")) %>%
  mutate(scoredifference = ifelse(home_team_fav == "Home", score_home - score_away, score_away - score_home)) %>%
  mutate(abs_spread = gsub(pattern = "-", replacement = "", spread_favorite)) %>%
  mutate(cover = ifelse(scoredifference > abs_spread, T, ifelse(scoredifference == abs_spread, "PUSH", F)))

view(Scores2)
```

```{r}
Scores2 %>%
  group_by(cover) %>%
  summarise(spread_hits = n()) %>%
  arrange(desc(spread_hits))
```

```{r}
Scores2 %>%
  ggplot(aes(x = weather_temperature, y = scoredifference))+
  geom_point(aes(color = cover)) + 
  facet_wrap(~home_team_fav, ncol = 4) +
  xlim(-10, 45) 

```

Based off this scatterplot, one can see that there are a lot more home favorites than away favorites. The blue dots represent the favorites covering. 